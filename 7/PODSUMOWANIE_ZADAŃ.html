<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Ochrona Danych - Podsumowanie Zada≈Ñ 1-5</title>
    <style>
        * { margin: 0; padding: 0; }
        body { font-family: 'Segoe UI', Arial, sans-serif; line-height: 1.8; color: #2c3e50; padding: 60px 50px; max-width: 1000px; margin: 0 auto; background: #f8f9fa; }
        
        h1 { color: #1a4d7a; font-size: 2.2em; margin-bottom: 10px; border-bottom: 4px solid #3498db; padding-bottom: 15px; text-align: center; }
        h2 { color: #2980b9; font-size: 1.5em; margin-top: 40px; margin-bottom: 20px; border-left: 5px solid #3498db; padding-left: 15px; }
        h3 { color: #34495e; font-size: 1.1em; margin-top: 15px; margin-bottom: 10px; }
        
        p { margin: 15px 0; }
        li { margin: 8px 0; margin-left: 20px; }
        
        code { background: #ecf0f1; padding: 3px 8px; border-radius: 3px; font-family: 'Courier New', monospace; font-size: 0.95em; color: #c0392b; }
        pre { background: #2c3e50; color: #ecf0f1; padding: 20px; border-radius: 5px; overflow-x: auto; line-height: 1.5; margin: 15px 0; border-left: 4px solid #e74c3c; }
        pre code { background: none; padding: 0; color: #ecf0f1; font-size: 0.9em; }
        
        table { border-collapse: collapse; width: 100%; margin: 20px 0; background: white; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        table th { background: #3498db; color: white; padding: 15px; text-align: left; font-weight: bold; }
        table td { border: 1px solid #bdc3c7; padding: 12px 15px; }
        table tr:hover { background: #f0f7ff; }
        table tr:nth-child(even) { background: #f9f9f9; }
        
        .meta { text-align: center; color: #7f8c8d; font-size: 0.95em; margin-bottom: 30px; border-bottom: 1px solid #bdc3c7; padding-bottom: 20px; }
        .checklist { background: #d4edda; padding: 20px; border-left: 5px solid #28a745; margin: 20px 0; border-radius: 4px; }
        .architecture { background: #e3f2fd; padding: 15px; border-left: 5px solid #2196f3; margin: 15px 0; font-family: monospace; line-height: 1.6; }
        .key-point { background: #fff3cd; padding: 15px; border-left: 5px solid #ffc107; margin: 15px 0; border-radius: 4px; }
        
        .section { page-break-inside: avoid; background: white; padding: 20px; margin: 20px 0; border-radius: 5px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
        
        strong { color: #c0392b; font-weight: bold; }
        em { color: #8e44ad; font-style: italic; }
        
        @media print { 
            body { background: white; }
            .section { page-break-inside: avoid; box-shadow: none; border: 1px solid #ddd; }
            a { color: #2980b9; text-decoration: underline; }
        }
    </style>
</head>
<body>

<div class="meta">
    <strong>Ochrona Danych - Praktyka Bezpiecze≈Ñstwa Sieci</strong><br>
    Podsumowanie Zada≈Ñ 1-5<br>
    27 listopada 2025 | Pawe≈Ç
</div>

<h1>Ochrona Danych - Podsumowanie Zada≈Ñ 1-5</h1>

<p><strong>Przedmiot:</strong> Ochrona Danych  </p>
<p><strong>Data:</strong> 27 listopada 2025  </p>
<p><strong>Student:</strong> Pawe≈Ç  </p>

<p>---</p>

<h2>üéØ Cel Projektu</h2>

<p>Zbudowaƒá bezpiecznƒÖ architekturƒô web aplikacji z:</p>
<li>Szyfrowaniem HTTPS (SSL/TLS)</li>
<li>Nginx jako reverse proxy</li>
<li>Flask + Gunicorn (production WSGI server, <strong>nie dev server</strong>)</li>
<li>Obs≈ÇugƒÖ uprawnie≈Ñ proces√≥w</li>
<li>DetekcjƒÖ rzeczywistego IP klienta</li>

<p>---</p>

<h2>‚úÖ Zadanie 1: Wygenerowaƒá Certyfikat Samopodpisany</h2>

<p><strong>Co robiƒá:</strong></p>
<pre><code class="bash">
bash generate_cert.sh
</code></pre>

<p><strong>Wynik:</strong></p>
<li><code>certs/server.crt</code> - 1302 bytes (certyfikat)</li>
<li><code>certs/server.key</code> - 1704 bytes (klucz prywatny)</li>
<li>Wa≈ºny przez 365 dni</li>
<li>RSA 2048-bit, SHA256</li>

<p><strong>Znaczenie:</strong> Szyfrowanie HTTPS wymaga certyfikatu. Samopodpisany wystarczy do test√≥w.</p>

<p>---</p>

<h2>‚úÖ Zadanie 2: Skonfigurowaƒá Nginx dla HTTPS</h2>

<p><strong>Architektura:</strong></p>
<pre><code class="">
Klient (HTTPS :443) ‚Üê‚Üí Nginx (SSL terminator)
       ‚Üì
HTTP :80 ‚Üí redirect 301 ‚Üí HTTPS :443
</code></pre>

<p><strong>Kroki:</strong></p>

<p>Terminal 1 (WSL):</p>
<pre><code class="bash">
sudo killall nginx
sudo bash run_nginx.sh
</code></pre>

<p>Terminal 2 (PowerShell):</p>
<pre><code class="powershell">
# Test HTTP ‚Üí HTTPS redirect (301)
curl -I http://localhost/
# ‚Üí HTTP/1.1 301 Moved Permanently
# ‚Üí Location: https://localhost/

# Test HTTPS (bƒôdzie 502, bo Flask nie dzia≈Ça)
curl -k https://localhost/
# ‚Üí &lt;html&gt;&lt;h1&gt;502 Bad Gateway&lt;/h1&gt;&lt;/html&gt;
</code></pre>

<p><strong>Znaczenie:</strong> </p>
<li>Flaga <code>-k</code> = ignoruj warning o samopodpisanym certyfikacie</li>
<li>301 status = permanent redirect</li>
<li>502 = nginx czeka na backend (normalnie na tym etapie)</li>

<p><strong>Konfiguracja:</strong></p>
<li>Port 80: HTTP redirect do HTTPS</li>
<li>Port 443: SSL/TLS, proxy do <code>127.0.0.1:8000</code></li>
<li>Sertyfikaty: <code>./certs/server.crt</code> i `./certs/server.key`</li>

<p>---</p>

<h2>‚úÖ Zadanie 3: Nginx jako Proxy do Flask/Gunicorn</h2>

<p><strong>WA≈ªNE:</strong> Flask musi byƒá na <em></em>Gunicorn** (production WSGI), NIE na dev serverze!</p>

<p><strong>Architektura:</strong></p>
<pre><code class="">
Klient ‚Üí Nginx (SSL, reverse proxy) ‚Üí Gunicorn (127.0.0.1:8000) ‚Üí Flask (app)
</code></pre>

<p><strong>Kroki:</strong></p>

<p>Terminal 1 (WSL) - Nginx:</p>
<pre><code class="bash">
sudo bash run_nginx.sh
</code></pre>

<p>Terminal 2 (WSL) - Flask:</p>
<pre><code class="bash">
export PATH="/home/pawel/.local/bin:$PATH"
cd '/mnt/d/stud/sem 5/OchronaDanych/7'
bash run_flask.sh
</code></pre>

<p>Terminal 3 (PowerShell) - Test:</p>
<pre><code class="powershell">
# Endpoint g≈Ç√≥wny
curl -k https://localhost/

# Health check
curl -k https://localhost/health
</code></pre>

<p><strong>Wynik - JSON:</strong></p>
<pre><code class="json">
{
  "status": "ok",
  "https": true,
  "message": "Flask application running with Gunicorn through Nginx SSL proxy",
  "client_ip": "127.0.0.1",
  "process_info": {...},
  "headers": {...},
  "server_info": {...}
}
</code></pre>

<p><strong>Znaczenie:</strong> </p>
<li>Gunicorn to production server (stabilny, skalujƒÖcy)</li>
<li>Flask dev server NIE powinien byƒá w production</li>
<li>Nginx oddala Flask od dostƒôpu bezpo≈õredniego (bezpiecze≈Ñstwo)</li>

<p>---</p>

<h2>‚úÖ Zadanie 4: Uprawnienia Procesu Flask</h2>

<p><strong>Polecenie:</strong></p>
<pre><code class="powershell">
curl -k https://localhost/process-info
</code></pre>

<p><strong>Wynik:</strong></p>
<pre><code class="json">
{
  "uid": 1000,
  "gid": 1000,
  "username": "pawel",
  "current_user": "pawel",
  "home": "/home/pawel",
  "groups": [4,20,24,25,27,29,30,44,46,116,1000]
}
</code></pre>

<p><strong>Co to oznacza:</strong></p>
<table><tr><td colspan="4">| Pole | Warto≈õƒá | Znaczenie |</td></tr></table>
<table><tr><td colspan="4">|------|---------|-----------|</td></tr></table>
<table><tr><td colspan="4">| `uid` | 1000 | Zwyk≈Çy user (NOT root/0) |</td></tr></table>
<table><tr><td colspan="4">| `gid` | 1000 | Grupa u≈ºytkownika |</td></tr></table>
<table><tr><td colspan="4">| `username` | pawel | Nazwa u≈ºytkownika |</td></tr></table>
<table><tr><td colspan="4">| `groups` | [...] | Grupy do kt√≥rych nale≈ºy |</td></tr></table>

<p><strong>Znaczenie:</strong> </p>
<li>Flask dzia≈Ça jako zwyk≈Çy user <code>pawel</code>, <strong>nie</strong> jako `root`</li>
<li>To bezpieczne - ogranicza szkody w razie breakscha</li>
<li>Root (uid=0) ma nieograniczone uprawnienia - ryzyko!</li>

<p>---</p>

<h2>‚úÖ Zadanie 5: Odczytanie Rzeczywistego IP Klienta</h2>

<p><strong>Problem:</strong> W architekturze proxy, Flask widzi IP = localhost, ale rzeczywisty klient jest zdalnie.</p>

<p><strong>RozwiƒÖzanie:</strong> Nginx dodaje nag≈Ç√≥wek <code>X-Forwarded-For</code> z rzeczywistym IP.</p>

<p><strong>Polecenie:</strong></p>
<pre><code class="powershell">
curl -k https://localhost/client-ip
</code></pre>

<p><strong>Wynik:</strong></p>
<pre><code class="json">
{
  "client_ip": "127.0.0.1",
  "remote_addr": "127.0.0.1",
  "x_forwarded_for": "127.0.0.1",
  "x_real_ip": "127.0.0.1"
}
</code></pre>

<p><strong>Co to oznacza:</strong></p>
<table><tr><td colspan="4">| Pole | Warto≈õƒá | ≈πr√≥d≈Ço |</td></tr></table>
<table><tr><td colspan="4">|------|---------|--------|</td></tr></table>
<table><tr><td colspan="4">| `client_ip` | 127.0.0.1 | Detected z `X-Forwarded-For` |</td></tr></table>
<table><tr><td colspan="4">| `remote_addr` | 127.0.0.1 | Po≈ÇƒÖczenie do Flaska (localhost) |</td></tr></table>
<table><tr><td colspan="4">| `x_forwarded_for` | 127.0.0.1 | Nag≈Ç√≥wek od Nginx'a |</td></tr></table>
<table><tr><td colspan="4">| `x_real_ip` | 127.0.0.1 | Nag≈Ç√≥wek od Nginx'a |</td></tr></table>

<p><strong>Znaczenie:</strong></p>
<li><code>remote_addr</code> = IP kt√≥ry siƒô pod≈ÇƒÖczy do Flaska (tu: localhost bo proxy)</li>
<li><code>X-Forwarded-For</code> = rzeczywisty IP klienta (przekazany przez Nginx)</li>
<li><strong>ProxyFix middleware</strong> w Flasku parsuje te nag≈Ç√≥wki</li>
<li>W produkcji: <code>client_ip</code> bƒôdzie rzeczywistym IP z Internetu</li>

<p><strong>W nginx.conf:</strong></p>
<pre><code class="nginx">
proxy_set_header X-Real-IP $remote_addr;
proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
proxy_set_header X-Forwarded-Proto $scheme;
</code></pre>

<p>---</p>

<h2>üèóÔ∏è Technologia Stack</h2>

<table><tr><td colspan="4">| Komponent | Rola | Port |</td></tr></table>
<table><tr><td colspan="4">|-----------|------|------|</td></tr></table>
<table><tr><td colspan="4">| **Nginx** 1.18.0 | Reverse proxy, SSL terminator | 80, 443 |</td></tr></table>
<table><tr><td colspan="4">| **Flask** 3.0.0 | Web framework | - |</td></tr></table>
<table><tr><td colspan="4">| **Gunicorn** 21.2.0 | WSGI application server | 8000 |</td></tr></table>
<table><tr><td colspan="4">| **Werkzeug** 3.0.0 | ProxyFix middleware | - |</td></tr></table>
<table><tr><td colspan="4">| **OpenSSL** | SSL certificate generation | - |</td></tr></table>
<table><tr><td colspan="4">| **WSL** | Linux environment na Windows | - |</td></tr></table>

<p>---</p>

<h2>üîê Security Features</h2>

<p style="color: green;">‚úÖ <strong>HTTPS Only</strong> - HTTP auto-redirect do HTTPS (301)  </p>
<p style="color: green;">‚úÖ <strong>TLS 1.2 + 1.3</strong> - Modern encryption  </p>
<p style="color: green;">‚úÖ <strong>Self-signed Certificate</strong> - RSA 2048-bit  </p>
<p style="color: green;">‚úÖ <strong>Regular User</strong> - Flask uid=1000 (NOT root)  </p>
<p style="color: green;">‚úÖ <strong>Reverse Proxy</strong> - Flask nie dostƒôpny bezpo≈õrednio  </p>
<p style="color: green;">‚úÖ <strong>Security Headers</strong> - HSTS, X-Frame-Options, itp.  </p>
<p style="color: green;">‚úÖ <strong>Real IP Detection</strong> - X-Forwarded-For support  </p>

<p>---</p>

<h2>üìã Checklist Weryfikacji</h2>

<li>[x] Certyfikat wygenerowany (<code>certs/server.crt</code>, `server.key`)</li>
<li>[x] Nginx running na portach 80/443</li>
<li>[x] HTTP redirect do HTTPS (301 status)</li>
<li>[x] HTTPS dostƒôpny (bez 502 po uruchomieniu Flaska)</li>
<li>[x] Gunicorn binding na 127.0.0.1:8000</li>
<li>[x] Flask accessible przez proxy</li>
<li>[x] <code>/process-info</code> pokazuje uid=1000 (zwyk≈Çy user)</li>
<li>[x] <code>/client-ip</code> pokazuje X-Forwarded-For headers</li>
<li>[x] Pe≈Çny flow: Klient ‚Üí Nginx ‚Üí Gunicorn ‚Üí Flask</li>

<p>---</p>

<h2>üí° Kluczowe Punkty do Zaprezentowania</h2>

<p>1. <strong>Certyfikat samopodpisany</strong> - potrzebny do HTTPS, wa≈ºny 365 dni</p>
<p>2. <strong>Nginx + reverse proxy</strong> - oddala Flask od sieci, obs≈Çuguje SSL</p>
<p>3. <strong>Gunicorn nie Flask dev</strong> - production-ready, skaluje siƒô</p>
<p>4. <strong>uid=1000 (regular user)</strong> - bezpiecze≈Ñstwo, nie root</p>
<p>5. <strong>X-Forwarded-For headers</strong> - rzeczywisty IP mimo proxy</p>

<p>---</p>

<p><strong>Gotowy do rozmowy z prowadzƒÖcym! üöÄ</strong></p>


<div style="text-align: center; margin-top: 60px; padding-top: 20px; border-top: 2px solid #bdc3c7; color: #7f8c8d;">
    <p><strong>‚úÖ Gotowy do rozmowy z prowadzƒÖcym!</strong></p>
    <p style="font-size: 0.9em;">Dokument wygenerowany: 27.11.2025 | Wersja: 1.0</p>
</div>

</body>
</html>